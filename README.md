These scripts are used to cleanup main branch in the main branch in a way that only tagged (released) commits will present creating linear history without any garbage.
They also create and use a tag history file mapping new commits to original commits for a given tag. This file can be used with `restore-tags.sh` script to restore tags - tag original commits.
`clean-main.sh` will:
1. create new branch called `main-clean` and 
2. get the list of tags from git
3. `git rm -rf . > /dev/null` the working directory
4. use the tag list to checkout tagged commits one by one using `git checkout <tag> -- .`
5. get the commit message
6. create a new commit, which message will contain the origin commit message and reference to the original commit hash
7. diff new commit and the original commit using `git diff HEAD <original commit>` and if they are the same then tag the new commit with the original tag
8. update the tag history file

Before running `cleanup-main.sh` make sure to create backup of the main branch and `develop` branch:
```
git checkout main
git branch main-backup
git branch develop
```
Then run `cleanup-main.sh`:
```
../cleanup-main.sh ../tag-history-mapping.csv
```
Sometimes the tool will fail because the working directory was not clean. To resolve this issue delete `main-clean` branch and run the tool again:
```
git checkout main
git branch -D main-clean
```
After successful execution make sure that the original `main` branch gets deleted and `main-clean` renamed to `main`:
```
# make sure you are in main-clean branch
git checkout main-clean
git branch -D main
git branch -m main-clean main
```
Of course the `main` branch is a product branch so you do not use it for development but for releasing. Therefore switch to `develop` branch:
```
git checkout develop
```

If for any reason you want to restore orginal tags (assing them to original commits) please run `./restore-tags.sh <path to tag mapping csv file generated by cleanup-main.sh>`
